<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä monobank</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            
            --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --space-32: 32px;
            --radius-base: 8px;
            --radius-lg: 12px;
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;
                
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
            }
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: var(--font-family-base);
            background-color: var(--color-background);
            color: var(--color-text);
            padding: var(--space-24);
            line-height: 1.5;
        }
        
        .container { max-width: 1000px; margin: 0 auto; }
        
        h1 { font-size: 28px; font-weight: 600; margin-bottom: var(--space-8); color: var(--color-text); }
        .subtitle { color: var(--color-text-secondary); margin-bottom: var(--space-32); font-size: 14px; }
        
        .tabs { display: flex; gap: var(--space-8); margin-bottom: var(--space-24); border-bottom: 1px solid var(--color-border); }
        .tab {
            padding: var(--space-12) var(--space-24);
            background: none; border: none;
            color: var(--color-text-secondary); cursor: pointer;
            font-size: 15px; font-weight: 500;
            border-bottom: 2px solid transparent; transition: all 0.2s;
        }
        .tab:hover { color: var(--color-text); }
        .tab.active { color: var(--color-primary); border-bottom-color: var(--color-primary); }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card {
            background-color: var(--color-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-card-border);
            padding: var(--space-24);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-24);
        }
        
        .form-group { margin-bottom: var(--space-20); }
        
        label { display: block; margin-bottom: var(--space-8); font-weight: 500; font-size: 14px; color: var(--color-text); }
        
        input[type="number"], select {
            width: 100%; padding: var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: 15px;
            background-color: var(--color-background);
            color: var(--color-text);
            transition: border-color 0.2s;
        }
        input[type="number"]:focus, select:focus { outline: none; border-color: var(--color-primary); }
        
        .btn {
            width: 100%; padding: var(--space-12) var(--space-24);
            background-color: var(--color-primary);
            color: white; border: none; border-radius: var(--radius-base);
            font-size: 15px; font-weight: 500; cursor: pointer;
            transition: background-color 0.2s;
        }
        .btn:hover { background-color: var(--color-primary-hover); }
        
        .btn-ghost {
            background-color: rgba(var(--color-teal-500-rgb), 0.15);
            color: var(--color-primary);
            margin-bottom: var(--space-16);
        }
        .btn-ghost:hover { background-color: rgba(var(--color-teal-500-rgb), 0.25); }
        
        .result-section {
            margin-top: var(--space-24);
            padding: var(--space-20);
            background-color: var(--color-background);
            border-radius: var(--radius-base);
            border: 1px solid var(--color-card-border);
        }
        
        .result-item {
            display: flex; justify-content: space-between;
            padding: var(--space-12) 0;
            border-bottom: 1px solid var(--color-border);
        }
        .result-item:last-child { border-bottom: none; }
        
        .result-label { color: var(--color-text-secondary); font-size: 14px; }
        .result-value { font-weight: 600; font-size: 16px; color: var(--color-text); }
        .result-value.highlight { color: var(--color-primary); font-size: 18px; }
        
        .info-box {
            background-color: rgba(var(--color-teal-500-rgb), 0.08);
            border-left: 3px solid var(--color-primary);
            padding: var(--space-16);
            border-radius: var(--radius-base);
            margin-top: var(--space-16);
            font-size: 13px; color: var(--color-text-secondary);
        }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-16); }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-12); }
        @media (max-width: 640px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } }
        
        .rate-badge {
            display: inline-block; padding: 4px 10px;
            background-color: rgba(var(--color-teal-500-rgb), 0.15);
            color: var(--color-primary);
            border-radius: 4px; font-size: 13px; font-weight: 600; margin-left: var(--space-8);
        }
        
        .period-card {
            background-color: var(--color-background);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-base);
            padding: var(--space-16);
            margin-bottom: var(--space-16);
            position: relative;
        }
        .period-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-12); }
        .period-title { font-weight: 600; font-size: 14px; color: var(--color-text); }
        
        .remove-btn {
            background: none; border: none; color: var(--color-text-secondary);
            cursor: pointer; font-size: 20px; padding: 0; width: 24px; height: 24px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 4px; transition: all 0.2s;
        }
        .remove-btn:hover { background-color: rgba(192, 21, 47, 0.1); color: rgba(192, 21, 47, 1); }

        /* --- STYLES FOR KDZ INTERACTIVE TABLE --- */
        .kdz-table-container {
            overflow-x: auto;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            margin-top: var(--space-20);
        }
        .kdz-table {
            width: 100%; border-collapse: collapse; min-width: 700px;
            font-size: 14px;
        }
        .kdz-table th {
            background-color: rgba(var(--color-teal-500-rgb), 0.08);
            padding: 10px 12px;
            text-align: left; font-weight: 600; color: var(--color-text);
            border-bottom: 1px solid var(--color-border);
        }
        .kdz-table td {
            padding: 8px 12px;
            border-bottom: 1px solid var(--color-border);
            vertical-align: middle;
            color: var(--color-text);
        }
        .kdz-table tr:last-child td { border-bottom: none; }
        
        /* Interactive Inputs inside Table */
        .kdz-input {
            width: 90px; padding: 6px 8px;
            font-size: 14px; text-align: right;
            border: 1px solid var(--color-border);
            border-radius: 6px;
        }
        .kdz-input:focus { border-color: var(--color-primary); }
        .kdz-input::placeholder { color: #ccc; }
        
        .kdz-checkbox-label {
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; cursor: pointer; color: var(--color-text-secondary);
        }
        .kdz-checkbox-label input { margin-right: 4px; width: 14px; height: 14px; }
        
        .kdz-row-active { background-color: rgba(var(--color-teal-500-rgb), 0.03); }
        .text-dim { color: var(--color-text-secondary); font-size: 13px; }
        .text-bold { font-weight: 600; }
        
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¶ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä monobank</h1>
        <p class="subtitle">–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø—Ä–æ—Ü–µ–Ω—Ç—ñ–≤ –∑–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∏–º –ª—ñ–º—ñ—Ç–æ–º</p>
        
        <div class="tabs">
            <button class="tab active" data-tab="credit">–ö—Ä–µ–¥–∏—Ç–Ω–∏–π –ª—ñ–º—ñ—Ç</button>
            <button class="tab" data-tab="installment">–†–æ–∑—Å—Ç—Ä–æ—á–∫–∞</button>
            <button class="tab" data-tab="kdz">–ö–î–ó (–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä)</button>
        </div>
        
        <!-- ======================= -->
        <!-- 1. –ö–†–ï–î–ò–¢–ù–ò–ô –õ–Ü–ú–Ü–¢      -->
        <!-- ======================= -->
        <div class="tab-content active" id="credit">
            <div class="card">
                <h2 style="margin-bottom: var(--space-16); font-size: 20px;">
                    –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø—Ä–æ—Ü–µ–Ω—Ç—ñ–≤ –∑–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∏–º –ª—ñ–º—ñ—Ç–æ–º
                </h2>
                
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="leapYearCredit" style="width: auto;">
                        –í–∏—Å–æ–∫–æ—Å–Ω–∏–π —Ä—ñ–∫ (366 –¥–Ω—ñ–≤)
                    </label>
                </div>
                
                <h3 style="margin: var(--space-20) 0 var(--space-12) 0; font-size: 16px; font-weight: 600;">
                    –°—Ç–∞–≤–∫–∞ 3.1%
                </h3>
                <div id="periods31"></div>
                <button class="btn btn-ghost" onclick="addPeriod31()">+ –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥ 3.1%</button>
                
                <h3 style="margin: var(--space-20) 0 var(--space-12) 0; font-size: 16px; font-weight: 600;">
                    –°—Ç–∞–≤–∫–∞ 6.2%
                </h3>
                <div id="periods62"></div>
                <button class="btn btn-ghost" onclick="addPeriod62()">+ –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥ 6.2%</button>
                
                <h3 style="margin: var(--space-20) 0 var(--space-12) 0; font-size: 16px; font-weight: 600;">
                    –°—É–º–∞ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–æ–≥–æ –ª—ñ–º—ñ—Ç—É
                </h3>
                <div class="form-group">
                    <label>–°—É–º–∞ –Ω–∞ –∫—ñ–Ω–µ—Ü—å –º—ñ—Å—è—Ü—è</label>
                    <div style="display: flex; gap: var(--space-12);">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: var(--space-12); border: 1px solid var(--color-border); border-radius: var(--radius-base); flex: 1; background-color: var(--color-background);">
                            <input type="radio" name="overdraftRange" value="less" checked style="width: auto;">
                            –ú–µ–Ω—à–µ 1000 –≥—Ä–Ω (3.1%)
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: var(--space-12); border: 1px solid var(--color-border); border-radius: var(--radius-base); flex: 1; background-color: var(--color-background);">
                            <input type="radio" name="overdraftRange" value="more" style="width: auto;">
                            1000 –≥—Ä–Ω —ñ –±—ñ–ª—å—à–µ (6.2%)
                        </label>
                    </div>
                </div>
                <div id="periodsOverdraft"></div>
                <button class="btn btn-ghost" onclick="addPeriodOverdraft()">+ –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è</button>
                
                <button class="btn" onclick="calculateCredit()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤—Å–µ —Ä–∞–∑–æ–º</button>
                
                <div class="result-section" id="resultCredit" style="display: none;">
                    <div class="result-item">
                        <span class="result-label">–í—ñ–¥—Å–æ—Ç–∫–∏ 3.1%</span>
                        <span class="result-value" id="interest31">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–í—ñ–¥—Å–æ—Ç–∫–∏ 6.2%</span>
                        <span class="result-value" id="interest62">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item" style="border-top: 2px solid var(--color-border); padding-top: var(--space-16); margin-top: var(--space-8);">
                        <span class="result-label" style="font-weight: 600;">–í—Å—å–æ–≥–æ –∑–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∏–π –ª—ñ–º—ñ—Ç</span>
                        <span class="result-value highlight" id="totalInterest">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item" style="margin-top: var(--space-16); padding-top: var(--space-16); border-top: 1px solid var(--color-border);">
                        <span class="result-label">–û–≤–µ—Ä–¥—Ä–∞—Ñ—Ç (—Å—Ç–∞–≤–∫–∞: <span id="appliedRate">0%</span>)</span>
                        <span class="result-value" id="interestOverdraft">0 –≥—Ä–Ω</span>
                    </div>
                </div>
                
                <div class="info-box">
                    ‚ÑπÔ∏è –§–æ—Ä–º—É–ª–∞: (–°—É–º–∞ √ó –ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤ √ó –°—Ç–∞–≤–∫–∞% √ó 12) / 365(366) / 100.
                </div>
            </div>
        </div>
        
        <!-- ======================= -->
        <!-- 2. –†–û–ó–°–¢–†–û–ß–ö–ê           -->
        <!-- ======================= -->
        <div class="tab-content" id="installment">
            <div class="card">
                <h2 style="margin-bottom: var(--space-16); font-size: 20px;">
                    –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ä–æ–∑—Å—Ç—Ä–æ—á–∫–∏ <span class="rate-badge">1.9%/–º—ñ—Å</span>
                </h2>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label for="amountInst">–°—É–º–∞ —Ä–æ–∑—Å—Ç—Ä–æ—á–∫–∏ (–≥—Ä–Ω)</label>
                        <input type="number" id="amountInst" value="30000" step="0.01" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="monthsInst">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—è—Ü—ñ–≤</label>
                        <input type="number" id="monthsInst" value="6" min="1" max="24">
                    </div>
                </div>
                
                <button class="btn" onclick="calculateInstallment()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
                
                <div class="result-section" id="resultInst" style="display: none;">
                    <div class="result-item">
                        <span class="result-label">–©–æ–º—ñ—Å—è—á–Ω–∏–π –ø–ª–∞—Ç—ñ–∂</span>
                        <span class="result-value highlight" id="monthlyPayment">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–ö–æ–º—ñ—Å—ñ—è –∑–∞ –º—ñ—Å—è—Ü—å</span>
                        <span class="result-value" id="monthlyFee">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–ó–∞–≥–∞–ª—å–Ω–∞ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞</span>
                        <span class="result-value" id="totalOverpayment">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–í—Å—å–æ–≥–æ –¥–æ —Å–ø–ª–∞—Ç–∏</span>
                        <span class="result-value" id="totalInstallment">0 –≥—Ä–Ω</span>
                    </div>
                </div>
                
                <div class="info-box">
                    ‚ÑπÔ∏è –ö–æ–º—ñ—Å—ñ—è 1.9% –≤—ñ–¥ —Å—É–º–∏ —Ä–æ–∑—Å—Ç—Ä–æ—á–∫–∏ —â–æ–º—ñ—Å—è—Ü—è
                </div>
            </div>
        </div>

        <!-- ======================= -->
        <!-- 3. –ö–î–ó (–Ü–ù–¢–ï–†–ê–ö–¢–ò–í)     -->
        <!-- ======================= -->
        <div class="tab-content" id="kdz">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-20);">
                    <h2 style="font-size: 20px; margin: 0;">–ö—Ä–µ–¥–∏—Ç ¬´–î–æ –∑–∞–≤—Ç—Ä–∞¬ª</h2>
                    <button class="btn btn-ghost" style="width: auto; padding: 6px 12px; font-size: 13px; margin: 0;" onclick="resetKdz()">
                        üîÑ –û—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ
                    </button>
                </div>

                <!-- –í–µ—Ä—Ö–Ω—ñ–π –±–ª–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ -->
                <div class="grid-3" style="align-items: flex-end; margin-bottom: var(--space-24);">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–¢—ñ–ª–æ –∫—Ä–µ–¥–∏—Ç—É (–≥—Ä–Ω)</label>
                        <input type="number" id="kdzBody" value="5000" oninput="initKdzTable()">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤</label>
                        <input type="number" id="kdzDays" value="14" min="1" max="365" oninput="initKdzTable()">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–°—Ç–∞–≤–∫–∞ –Ω–∞ –¥–µ–Ω—å</label>
                        <select id="kdzRate" onchange="initKdzTable()">
                            <option value="0.3">0.3% –Ω–∞ –¥–µ–Ω—å</option>
                            <option value="0.5">0.5% –Ω–∞ –¥–µ–Ω—å</option>
                        </select>
                    </div>
                </div>

                <!-- –ü—ñ–¥—Å—É–º–∫–∏ Live -->
                <div class="result-section" style="margin-top: 0; margin-bottom: var(--space-24);">
                    <div class="result-item">
                        <span class="result-label">–ó–∞–ª–∏—à–æ–∫ —Ç—ñ–ª–∞</span>
                        <span class="result-value highlight" id="liveBodyRemain">5000.00 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–ù–∞—Ä–∞—Ö–æ–≤–∞–Ω—ñ –≤—ñ–¥—Å–æ—Ç–∫–∏</span>
                        <span class="result-value" id="liveInterestTotal">0.00 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–ö–æ–º—ñ—Å—ñ—è 4% (–∑ –∫—Ä–µ–¥–∏—Ç–Ω–∏—Ö)</span>
                        <span class="result-value" id="liveCommission">0.00 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item" style="border-top: 1px solid var(--color-border); padding-top: var(--space-12); margin-top: var(--space-8);">
                        <span class="result-label" style="color: var(--color-text); font-weight: 500;">–†–∞–∑–æ–º –¥–æ –ø–æ–≤–Ω–æ–≥–æ –∑–∞–∫—Ä–∏—Ç—Ç—è –∑–∞—Ä–∞–∑</span>
                        <span class="result-value highlight" id="liveTotalToPay">0.00 –≥—Ä–Ω</span>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 0;">
                    üëá –í–ø–∏—Å—É–π—Ç–µ –ø–æ–≥–∞—à–µ–Ω–Ω—è —É —Ç–∞–±–ª–∏—Ü—é –Ω–∏–∂—á–µ. –ì—Ä–∞—Ñ—ñ–∫ –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.
                </div>

                <!-- –¢–∞–±–ª–∏—Ü—è -->
                <div class="kdz-table-container">
                    <table class="kdz-table" id="kdzTable">
                        <thead>
                            <tr>
                                <th style="text-align: center; width: 40px;">#</th>
                                <th>–¢—ñ–ª–æ (—Ä–∞–Ω–æ–∫)</th>
                                <th>–ù–∞—Ä–∞—Ö. %</th>
                                <th style="background-color: rgba(var(--color-teal-500-rgb), 0.04);">–ü–æ–≥–∞—à–µ–Ω–Ω—è %</th>
                                <th style="background-color: rgba(var(--color-brown-600-rgb), 0.04);">–ü–æ–≥–∞—à–µ–Ω–Ω—è —Ç—ñ–ª–∞</th>
                                <th style="text-align: center;">–ö—Ä–µ–¥–∏—Ç–Ω—ñ?</th>
                                <th>–¢—ñ–ª–æ (–≤–µ—á—ñ—Ä)</th>
                                <th>–ë–æ—Ä–≥ –ø–æ %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- JS Generates Rows -->
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
    
    <script>
        // === GLOBAL VARIABLES & TABS ===
        let periodCounter31 = 0;
        let periodCounter62 = 0;
        let periodCounterOverdraft = 0;
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
                
                // If KDZ tab is opened, ensure table is rendered
                if(tabId === 'kdz') initKdzTable();
            });
        });

        // === 1. CREDIT LIMIT LOGIC ===
        function addPeriod31() {
            periodCounter31++;
            const div = document.createElement('div');
            div.className = 'period-card';
            div.id = 'period31-' + periodCounter31;
            div.innerHTML = `
                <div class="period-header">
                    <span class="period-title">–ü–µ—Ä—ñ–æ–¥ ${periodCounter31}</span>
                    <button class="remove-btn" onclick="document.getElementById('period31-${periodCounter31}').remove()">√ó</button>
                </div>
                <div class="grid-3">
                    <div class="form-group"><label>–î–µ–Ω—å –≤—ñ–¥</label><input type="number" class="debt31-from" value="1"></div>
                    <div class="form-group"><label>–î–µ–Ω—å –¥–æ</label><input type="number" class="debt31-to" value="10"></div>
                    <div class="form-group"><label>–°—É–º–∞</label><input type="number" class="debt31-amount" value="25000"></div>
                </div>`;
            document.getElementById('periods31').appendChild(div);
        }

        function addPeriod62() {
            periodCounter62++;
            const div = document.createElement('div');
            div.className = 'period-card';
            div.id = 'period62-' + periodCounter62;
            div.innerHTML = `
                <div class="period-header">
                    <span class="period-title">–ü–µ—Ä—ñ–æ–¥ ${periodCounter62}</span>
                    <button class="remove-btn" onclick="document.getElementById('period62-${periodCounter62}').remove()">√ó</button>
                </div>
                <div class="grid-3">
                    <div class="form-group"><label>–î–µ–Ω—å –≤—ñ–¥</label><input type="number" class="debt62-from" value="1"></div>
                    <div class="form-group"><label>–î–µ–Ω—å –¥–æ</label><input type="number" class="debt62-to" value="10"></div>
                    <div class="form-group"><label>–°—É–º–∞</label><input type="number" class="debt62-amount" value="25000"></div>
                </div>`;
            document.getElementById('periods62').appendChild(div);
        }

        function addPeriodOverdraft() {
            periodCounterOverdraft++;
            const div = document.createElement('div');
            div.className = 'period-card';
            div.id = 'periodOverdraft-' + periodCounterOverdraft;
            div.innerHTML = `
                <div class="period-header">
                    <span class="period-title">–ü–µ—Ä—ñ–æ–¥ ${periodCounterOverdraft}</span>
                    <button class="remove-btn" onclick="document.getElementById('periodOverdraft-${periodCounterOverdraft}').remove()">√ó</button>
                </div>
                <div class="grid-3">
                    <div class="form-group"><label>–î–µ–Ω—å –≤—ñ–¥</label><input type="number" class="overdraft-from" value="1"></div>
                    <div class="form-group"><label>–î–µ–Ω—å –¥–æ</label><input type="number" class="overdraft-to" value="10"></div>
                    <div class="form-group"><label>–°—É–º–∞</label><input type="number" class="overdraft-amount" value="2000"></div>
                </div>`;
            document.getElementById('periodsOverdraft').appendChild(div);
        }

        function calculateCredit() {
            const daysInYear = document.getElementById('leapYearCredit').checked ? 366 : 365;
            
            const calcGroup = (selector, rate) => {
                let total = 0;
                document.querySelectorAll(selector).forEach(card => {
                    const f = parseInt(card.querySelector('input:nth-child(2)').value)||0; // hacky selector, stick to class in prod
                    // let's use proper class selection inside function to be safe
                    const from = parseInt(card.querySelector('[class*="-from"]').value) || 0;
                    const to = parseInt(card.querySelector('[class*="-to"]').value) || 0;
                    const amt = parseFloat(card.querySelector('[class*="-amount"]').value) || 0;
                    const days = to - from + 1;
                    if(days > 0) total += (amt * days * rate * 12) / daysInYear / 100;
                });
                return total;
            };

            const i31 = calcGroup('#periods31 .period-card', 3.1);
            const i62 = calcGroup('#periods62 .period-card', 6.2);
            
            const odRate = document.querySelector('input[name="overdraftRange"]:checked').value === 'more' ? 6.2 : 3.1;
            const iOd = calcGroup('#periodsOverdraft .period-card', odRate);

            document.getElementById('interest31').textContent = i31.toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('interest62').textContent = i62.toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('totalInterest').textContent = (i31 + i62).toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('appliedRate').textContent = odRate + '%';
            document.getElementById('interestOverdraft').textContent = iOd.toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('resultCredit').style.display = 'block';
        }

        // === 2. INSTALLMENT LOGIC ===
        function calculateInstallment() {
            const amt = parseFloat(document.getElementById('amountInst').value) || 0;
            const mos = parseInt(document.getElementById('monthsInst').value) || 0;
            if (amt <= 0 || mos <= 0) return;

            const fee = amt * 0.019;
            const monthly = (amt / mos) + fee;
            const over = fee * mos;
            
            document.getElementById('monthlyPayment').textContent = monthly.toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('monthlyFee').textContent = fee.toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('totalOverpayment').textContent = over.toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('totalInstallment').textContent = (amt + over).toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('resultInst').style.display = 'block';
        }

        // === 3. KDZ INTERACTIVE LOGIC ===
        
        // State storage: { dayIndex: { int: 0, body: 0, isCredit: false } }
        let kdzData = {};

        function resetKdz() {
            kdzData = {};
            initKdzTable();
        }

        function initKdzTable() {
            const days = parseInt(document.getElementById('kdzDays').value) || 14;
            const startBody = parseFloat(document.getElementById('kdzBody').value) || 5000;
            const rate = parseFloat(document.getElementById('kdzRate').value) || 0.3;
            
            const tbody = document.querySelector('#kdzTable tbody');
            tbody.innerHTML = '';
            
            let currentBody = startBody;
            let accumulatedInt = 0;
            let totalIntAccrued = 0;
            let totalCommission = 0;
            
            for (let d = 1; d <= days; d++) {
                // 1. Accrue Interest
                const dailyInt = currentBody * rate / 100;
                totalIntAccrued += dailyInt;
                accumulatedInt += dailyInt;
                
                // 2. Get Payments from State
                const payData = kdzData[d] || { int: 0, body: 0, isCredit: false };
                const payInt = payData.int;
                const payBody = payData.body;
                
                // 3. Calc Commission
                if (payData.isCredit) {
                    totalCommission += (payInt * 0.04);
                }
                
                // 4. Apply Payments
                // Payments logic: first pay off accrued interest, then body (simplified for calculator)
                accumulatedInt -= payInt;
                if (accumulatedInt < 0) accumulatedInt = 0; // Overpayment of interest not handled logic-wise, just capped
                
                const bodyBefore = currentBody;
                currentBody -= payBody;
                if (currentBody < 0) currentBody = 0;
                
                // 5. Render Row
                const tr = document.createElement('tr');
                if (payInt > 0 || payBody > 0) tr.classList.add('kdz-row-active');
                
                tr.innerHTML = `
                    <td style="text-align: center; color: var(--color-text-secondary); font-size: 13px;">${d}</td>
                    <td class="text-dim">${bodyBefore.toFixed(2)}</td>
                    <td class="text-dim">+${dailyInt.toFixed(2)}</td>
                    
                    <td style="background-color: rgba(var(--color-teal-500-rgb), 0.02);">
                        <input type="number" class="kdz-input input-int" 
                               data-day="${d}" placeholder="0" 
                               value="${payInt > 0 ? payInt : ''}">
                    </td>
                    
                    <td style="background-color: rgba(var(--color-brown-600-rgb), 0.02);">
                        <input type="number" class="kdz-input input-body" 
                               data-day="${d}" placeholder="0" 
                               value="${payBody > 0 ? payBody : ''}">
                    </td>
                    
                    <td style="text-align: center;">
                        <label class="kdz-checkbox-label" title="–û–ø–ª–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∏–º–∏ (+4% –∫–æ–º—ñ—Å—ñ—ó)">
                            <input type="checkbox" class="input-check" 
                                   data-day="${d}" ${payData.isCredit ? 'checked' : ''}>
                        </label>
                    </td>
                    
                    <td class="text-bold">${currentBody.toFixed(2)}</td>
                    <td style="color: ${accumulatedInt > 0.01 ? '#c62828' : '#2e7d32'}; font-weight: 500;">
                        ${accumulatedInt.toFixed(2)}
                    </td>
                `;
                tbody.appendChild(tr);
            }
            
            // 6. Update Totals
            document.getElementById('liveBodyRemain').textContent = currentBody.toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('liveInterestTotal').textContent = totalIntAccrued.toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('liveCommission').textContent = totalCommission.toFixed(2) + ' –≥—Ä–Ω';
            
            const totalToPay = currentBody + accumulatedInt;
            document.getElementById('liveTotalToPay').textContent = totalToPay.toFixed(2) + ' –≥—Ä–Ω';
        }

        // --- Event Delegation for Inputs ---
        document.getElementById('kdzTable').addEventListener('input', (e) => {
            if (e.target.classList.contains('kdz-input')) {
                const day = e.target.getAttribute('data-day');
                const val = parseFloat(e.target.value);
                const isInt = e.target.classList.contains('input-int');
                
                if (!kdzData[day]) kdzData[day] = { int: 0, body: 0, isCredit: false };
                
                if (isInt) kdzData[day].int = isNaN(val) ? 0 : val;
                else kdzData[day].body = isNaN(val) ? 0 : val;
                
                // Re-render but keep focus
                saveFocusAndRender(e.target);
            }
        });

        document.getElementById('kdzTable').addEventListener('change', (e) => {
            if (e.target.classList.contains('input-check')) {
                const day = e.target.getAttribute('data-day');
                if (!kdzData[day]) kdzData[day] = { int: 0, body: 0, isCredit: false };
                kdzData[day].isCredit = e.target.checked;
                saveFocusAndRender(e.target);
            }
        });

        function saveFocusAndRender(activeEl) {
            const day = activeEl.getAttribute('data-day');
            const isInt = activeEl.classList.contains('input-int');
            const isBody = activeEl.classList.contains('input-body');
            const isCheck = activeEl.classList.contains('input-check');
            
            initKdzTable();
            
            let selector = '';
            if (isInt) selector = `.input-int[data-day="${day}"]`;
            else if (isBody) selector = `.input-body[data-day="${day}"]`;
            else if (isCheck) selector = `.input-check[data-day="${day}"]`;
            
            if (selector) {
                const el = document.querySelector(selector);
                if (el) el.focus();
            }
        }

        // --- Init ---
        addPeriod31();
        addPeriod62();
        addPeriodOverdraft();
        // KDZ will init on tab click to save perf, or manually here
    </script>
</body>
</html>
