<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä monobank</title>
    <style>
        :root {
            --color-background: #fcfcf9;
            --color-surface: #ffffff;
            --color-text: #13343b;
            --color-text-secondary: #626c71;
            --color-primary: #ea5357; /* mono red styling option, or keep teal */
            --color-primary-teal: #21808d;
            --color-border: rgba(94, 82, 64, 0.2);
            --radius-base: 12px;
            --space-16: 16px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            padding: 20px;
            line-height: 1.5;
        }

        .container { max-width: 1100px; margin: 0 auto; }
        
        /* Tabs Styling */
        .tabs { display: flex; gap: 10px; margin-bottom: 24px; border-bottom: 1px solid var(--color-border); }
        .tab { 
            padding: 12px 24px; 
            background: none; border: none; 
            font-size: 16px; font-weight: 500; color: var(--color-text-secondary);
            cursor: pointer; border-bottom: 3px solid transparent;
        }
        .tab.active { color: var(--color-primary-teal); border-bottom-color: var(--color-primary-teal); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Card Styling */
        .card {
            background: var(--color-surface);
            border-radius: var(--radius-base);
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 24px;
        }

        /* Forms */
        .form-group { margin-bottom: 16px; }
        label { display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px; }
        input[type="number"], select {
            width: 100%; padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: 8px; font-size: 16px;
        }
        
        .btn {
            width: 100%; padding: 14px;
            background-color: var(--color-primary-teal);
            color: white; border: none; border-radius: 8px;
            font-size: 16px; font-weight: 600; cursor: pointer;
        }
        .btn:hover { background-color: #1d7480; }
        .btn-outline {
            background: transparent; color: var(--color-primary-teal);
            border: 1px solid var(--color-primary-teal); margin-bottom: 16px;
        }

        /* Results & Info */
        .result-section {
            background: #f5f5f5; border-radius: 12px; padding: 20px; margin-top: 24px;
        }
        .result-item {
            display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 15px;
        }
        .result-value { font-weight: 700; }
        .highlight { color: var(--color-primary-teal); font-size: 18px; }
        .info-box {
            background: rgba(33, 128, 141, 0.1); color: #1d7480;
            padding: 12px; border-radius: 8px; font-size: 13px; margin-top: 16px;
            border-left: 4px solid var(--color-primary-teal);
        }

        /* Grid Layouts */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
        
        /* KDZ Specific Interactive Table */
        .kdz-table-wrapper {
            overflow-x: auto;
            border: 1px solid var(--color-border);
            border-radius: 12px;
            margin-top: 20px;
        }
        table { width: 100%; border-collapse: collapse; min-width: 800px; font-size: 14px; }
        th { background: #f0f2f5; padding: 12px 8px; text-align: left; font-weight: 600; position: sticky; top: 0; }
        td { padding: 8px; border-bottom: 1px solid #eee; vertical-align: middle; }
        
        /* Interactive Inputs in Table */
        .input-cell { width: 100px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        .input-cell:focus { border-color: var(--color-primary-teal); outline: none; background: #fff; }
        
        /* Checkbox styling */
        .cb-wrapper { display: flex; align-items: center; justify-content: center; gap: 4px; font-size: 11px; color: #666; cursor: pointer;}
        .cb-wrapper input { width: 16px; height: 16px; margin: 0; cursor: pointer; }
        
        /* Sticky Footer for Total */
        tfoot td { background: #f9fafb; font-weight: 700; padding: 12px; border-top: 2px solid #ddd; }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üè¶ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä monobank</h1>
    
    <div class="tabs">
        <button class="tab active" data-tab="credit">–ö—Ä–µ–¥–∏—Ç–Ω–∏–π –ª—ñ–º—ñ—Ç</button>
        <button class="tab" data-tab="installment">–†–æ–∑—Å—Ç—Ä–æ—á–∫–∞</button>
        <button class="tab" data-tab="kdz">–ö–î–ó (–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π)</button>
    </div>

    <!-- 1. –ö–†–ï–î–ò–¢–ù–ò–ô –õ–Ü–ú–Ü–¢ -->
    <div class="tab-content active" id="credit">
        <div class="card">
            <h2>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ % –∑–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∏–º –ª—ñ–º—ñ—Ç–æ–º</h2>
            <div class="form-group">
                <label><input type="checkbox" id="leapYearCredit"> –í–∏—Å–æ–∫–æ—Å–Ω–∏–π —Ä—ñ–∫ (366 –¥–Ω—ñ–≤)</label>
            </div>
            
            <h3>–°—Ç–∞–≤–∫–∞ 3.1%</h3>
            <div id="periods31"></div>
            <button class="btn btn-outline" onclick="addPeriod31()">+ –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥ 3.1%</button>
            
            <h3>–°—Ç–∞–≤–∫–∞ 6.2%</h3>
            <div id="periods62"></div>
            <button class="btn btn-outline" onclick="addPeriod62()">+ –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥ 6.2%</button>
            
            <h3>–ü–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è –ª—ñ–º—ñ—Ç—É (–û–≤–µ—Ä–¥—Ä–∞—Ñ—Ç)</h3>
            <div class="form-group">
                <label><input type="radio" name="overdraftRange" value="less" checked> –ú–µ–Ω—à–µ 1000 –≥—Ä–Ω (3.1%)</label>
                <label><input type="radio" name="overdraftRange" value="more"> 1000 –≥—Ä–Ω —ñ –±—ñ–ª—å—à–µ (6.2%)</label>
            </div>
            <div id="periodsOverdraft"></div>
            <button class="btn btn-outline" onclick="addPeriodOverdraft()">+ –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥ –æ–≤–µ—Ä–¥—Ä–∞—Ñ—Ç—É</button>

            <button class="btn" onclick="calculateCredit()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
            
            <div class="result-section" id="resultCredit" style="display:none;">
                <div class="result-item"><span>–í—Å—å–æ–≥–æ –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤:</span> <span class="result-value highlight" id="totalInterest">0 –≥—Ä–Ω</span></div>
                <div class="result-item"><span>–ó –Ω–∏—Ö 3.1%:</span> <span id="interest31">0 –≥—Ä–Ω</span></div>
                <div class="result-item"><span>–ó –Ω–∏—Ö 6.2%:</span> <span id="interest62">0 –≥—Ä–Ω</span></div>
                <div class="result-item"><span>–û–≤–µ—Ä–¥—Ä–∞—Ñ—Ç:</span> <span id="interestOverdraft">0 –≥—Ä–Ω</span></div>
            </div>
        </div>
    </div>

    <!-- 2. –†–û–ó–°–¢–†–û–ß–ö–ê -->
    <div class="tab-content" id="installment">
        <div class="card">
            <h2>–†–æ–∑—Å—Ç—Ä–æ—á–∫–∞ (1.9%/–º—ñ—Å)</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>–°—É–º–∞ (–≥—Ä–Ω)</label>
                    <input type="number" id="amountInst" value="30000">
                </div>
                <div class="form-group">
                    <label>–ú—ñ—Å—è—Ü—ñ–≤</label>
                    <input type="number" id="monthsInst" value="6">
                </div>
            </div>
            <button class="btn" onclick="calculateInstallment()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
            
            <div class="result-section" id="resultInst" style="display:none;">
                <div class="result-item"><span>–©–æ–º—ñ—Å—è—á–Ω–∏–π –ø–ª–∞—Ç—ñ–∂:</span> <span class="result-value highlight" id="monthlyPayment">0 –≥—Ä–Ω</span></div>
                <div class="result-item"><span>–©–æ–º—ñ—Å—è—á–Ω–∞ –∫–æ–º—ñ—Å—ñ—è:</span> <span id="monthlyFee">0 –≥—Ä–Ω</span></div>
                <div class="result-item"><span>–í—Å—å–æ–≥–æ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞:</span> <span id="totalOverpayment">0 –≥—Ä–Ω</span></div>
                <div class="result-item"><span>–ü–æ–≤–Ω–∞ —Å—É–º–∞ –≤–∏–ø–ª–∞—Ç–∏:</span> <span id="totalInstallment">0 –≥—Ä–Ω</span></div>
            </div>
        </div>
    </div>

    <!-- 3. –ö–î–ó (PRO –í–ï–†–°–Ü–Ø) -->
    <div class="tab-content" id="kdz">
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2>–ö–î–ó: –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫</h2>
                <button class="btn" style="width: auto; padding: 8px 16px; font-size: 14px; background: #626c71;" onclick="resetKdz()">üîÑ –°–∫–∏–Ω—É—Ç–∏</button>
            </div>
            
            <div class="grid-3" style="align-items: end; margin-bottom: 20px;">
                <div class="form-group" style="margin-bottom:0">
                    <label>–¢—ñ–ª–æ –∫—Ä–µ–¥–∏—Ç—É</label>
                    <input type="number" id="kdzBody" value="5000" oninput="initKdzTable()">
                </div>
                <div class="form-group" style="margin-bottom:0">
                    <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤</label>
                    <input type="number" id="kdzDays" value="14" min="1" max="60" oninput="initKdzTable()">
                </div>
                <div class="form-group" style="margin-bottom:0">
                    <label>–°—Ç–∞–≤–∫–∞</label>
                    <select id="kdzRate" onchange="initKdzTable()" style="padding: 12px;">
                        <option value="0.3">0.3% –Ω–∞ –¥–µ–Ω—å</option>
                        <option value="0.5">0.5% –Ω–∞ –¥–µ–Ω—å</option>
                    </select>
                </div>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ live -->
            <div class="result-section" style="margin-top: 0; background: #e0f2f1; border: 1px solid #21808d;">
                <div class="grid-3">
                    <div>
                        <span class="result-label">–ó–∞–ª–∏—à–æ–∫ —Ç—ñ–ª–∞</span>
                        <div class="result-value highlight" id="liveBodyRemain">5000.00 –≥—Ä–Ω</div>
                    </div>
                    <div>
                        <span class="result-label">–ù–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ %</span>
                        <div class="result-value" id="liveInterestTotal">0.00 –≥—Ä–Ω</div>
                    </div>
                    <div>
                        <span class="result-label">–ö–æ–º—ñ—Å—ñ—è 4%</span>
                        <div class="result-value" id="liveCommission">0.00 –≥—Ä–Ω</div>
                    </div>
                </div>
                <div style="margin-top: 10px; padding-top:10px; border-top:1px solid rgba(0,0,0,0.1); text-align: right;">
                    <span style="font-size:14px; margin-right: 10px;">–†–∞–∑–æ–º –¥–æ –ø–æ–≤–Ω–æ–≥–æ –∑–∞–∫—Ä–∏—Ç—Ç—è:</span>
                    <span class="result-value highlight" style="font-size: 20px;" id="liveTotalToPay">0.00 –≥—Ä–Ω</span>
                </div>
            </div>

            <div class="info-box">
                üëá <strong>–í–Ω–æ—Å—å—Ç–µ –ø–æ–≥–∞—à–µ–Ω–Ω—è –ø—Ä—è–º–æ –≤ —Ç–∞–±–ª–∏—Ü—é!</strong> –í–∫–∞–∂—ñ—Ç—å —Å—É–º—É –≤ –∫–æ–ª–æ–Ω–∫—É "–ü–æ–≥–∞—à–µ–Ω–Ω—è %" –∞–±–æ "–ü–æ–≥–∞—à–µ–Ω–Ω—è —Ç—ñ–ª–∞" —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –¥–µ–Ω—å. 
                –ü–æ—Å—Ç–∞–≤—Ç–µ –≥–∞–ª–æ—á–∫—É ‚òëÔ∏è, —è–∫—â–æ –æ–ø–ª–∞—Ç–∞ –±—É–ª–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∏–º–∏ –∫–æ—à—Ç–∞–º–∏ (–¥–æ–¥–∞—Å—Ç—å—Å—è 4%).
            </div>

            <div class="kdz-table-wrapper">
                <table id="kdzTable">
                    <thead>
                        <tr>
                            <th style="width: 50px; text-align: center;">–î–Ω</th>
                            <th>–¢—ñ–ª–æ (—Ä–∞–Ω–æ–∫)</th>
                            <th>% –∑–∞ –¥–µ–Ω—å</th>
                            <th style="background: #fff3e0;">–ü–æ–≥–∞—à–µ–Ω–Ω—è %</th>
                            <th style="background: #e3f2fd;">–ü–æ–≥–∞—à–µ–Ω–Ω—è —Ç—ñ–ª–∞</th>
                            <th>–û–ø—Ü—ñ—ó</th>
                            <th>–¢—ñ–ª–æ (–≤–µ—á—ñ—Ä)</th>
                            <th>–ë–æ—Ä–≥ –ø–æ %</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- –†—è–¥–∫–∏ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // --- –ó–ê–ì–ê–õ–¨–ù–ê –õ–û–ì–Ü–ö–ê –¢–ê–ë–Ü–í ---
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.dataset.tab).classList.add('active');
            if(tab.dataset.tab === 'kdz') initKdzTable(); // Init KDZ on tab switch
        });
    });

    // ==========================================
    // 1. –õ–û–ì–Ü–ö–ê –ö–†–ï–î–ò–¢–ù–û–ì–û –õ–Ü–ú–Ü–¢–£ (–±–µ–∑ –∑–º—ñ–Ω)
    // ==========================================
    let pc31=0, pc62=0, pcOd=0;
    
    function createPeriodHTML(id, type) {
        return `
        <div class="period-card" id="${type}-${id}" style="margin-bottom:12px; border:1px solid #eee; padding:10px; border-radius:8px;">
            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                <strong>–ü–µ—Ä—ñ–æ–¥ ${id}</strong>
                <button onclick="document.getElementById('${type}-${id}').remove()" style="color:red; background:none; border:none; cursor:pointer;">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            </div>
            <div class="grid-3">
                <div><label>–ó</label><input type="number" class="d-from" value="1"></div>
                <div><label>–ü–æ</label><input type="number" class="d-to" value="10"></div>
                <div><label>–°—É–º–∞</label><input type="number" class="d-amount" value="10000"></div>
            </div>
        </div>`;
    }

    function addPeriod31() { pc31++; document.getElementById('periods31').insertAdjacentHTML('beforeend', createPeriodHTML(pc31, 'p31')); }
    function addPeriod62() { pc62++; document.getElementById('periods62').insertAdjacentHTML('beforeend', createPeriodHTML(pc62, 'p62')); }
    function addPeriodOverdraft() { pcOd++; document.getElementById('periodsOverdraft').insertAdjacentHTML('beforeend', createPeriodHTML(pcOd, 'pod')); }

    function calculateCredit() {
        const daysInYear = document.getElementById('leapYearCredit').checked ? 366 : 365;
        let sum31=0, sum62=0, sumOd=0;

        // Helper
        const calc = (selector, rate) => {
            let total = 0;
            document.querySelectorAll(selector).forEach(el => {
                const f = +el.querySelector('.d-from').value;
                const t = +el.querySelector('.d-to').value;
                const a = +el.querySelector('.d-amount').value;
                const d = t - f + 1;
                if(d > 0) total += (a * d * rate * 12) / daysInYear / 100;
            });
            return total;
        };

        sum31 = calc('#periods31 .period-card', 3.1);
        sum62 = calc('#periods62 .period-card', 6.2);
        
        const odRate = document.querySelector('input[name="overdraftRange"]:checked').value === 'more' ? 6.2 : 3.1;
        sumOd = calc('#periodsOverdraft .period-card', odRate);

        document.getElementById('totalInterest').textContent = (sum31+sum62+sumOd).toFixed(2) + ' –≥—Ä–Ω';
        document.getElementById('interest31').textContent = sum31.toFixed(2) + ' –≥—Ä–Ω';
        document.getElementById('interest62').textContent = sum62.toFixed(2) + ' –≥—Ä–Ω';
        document.getElementById('interestOverdraft').textContent = sumOd.toFixed(2) + ' –≥—Ä–Ω';
        document.getElementById('resultCredit').style.display = 'block';
    }

    // ==========================================
    // 2. –õ–û–ì–Ü–ö–ê –†–û–ó–°–¢–†–û–ß–ö–ò (–±–µ–∑ –∑–º—ñ–Ω)
    // ==========================================
    function calculateInstallment() {
        const amt = +document.getElementById('amountInst').value;
        const mos = +document.getElementById('monthsInst').value;
        if(!amt || !mos) return;

        const fee = amt * 0.019;
        const pay = (amt / mos) + fee;
        
        document.getElementById('monthlyPayment').textContent = pay.toFixed(2) + ' –≥—Ä–Ω';
        document.getElementById('monthlyFee').textContent = fee.toFixed(2) + ' –≥—Ä–Ω';
        document.getElementById('totalOverpayment').textContent = (fee * mos).toFixed(2) + ' –≥—Ä–Ω';
        document.getElementById('totalInstallment').textContent = (amt + (fee * mos)).toFixed(2) + ' –≥—Ä–Ω';
        document.getElementById('resultInst').style.display = 'block';
    }

    // ==========================================
    // 3. –õ–û–ì–Ü–ö–ê –ö–î–ó (PRO - –Ü–ù–¢–ï–†–ê–ö–¢–ò–í–ù–ê)
    // ==========================================
    
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ –ø–æ–≥–∞—à–µ–Ω–Ω—è –≤ –æ–±'—î–∫—Ç—ñ { dayNum: { int: 0, body: 0, isCredit: false } }
    let kdzState = {}; 

    function resetKdz() {
        kdzState = {};
        initKdzTable();
    }

    function initKdzTable() {
        const days = +document.getElementById('kdzDays').value;
        const startBody = +document.getElementById('kdzBody').value;
        const rate = +document.getElementById('kdzRate').value;
        const tbody = document.querySelector('#kdzTable tbody');
        
        // –Ø–∫—â–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤ –∑–º—ñ–Ω–∏–ª–∞—Å—å, —Ç—Ä–µ–±–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ —ñ—Å–Ω—É—é—á—ñ –ø–æ–≥–∞—à–µ–Ω–Ω—è, —è–∫—ñ –≤–ª–∞–∑—è—Ç—å –≤ –Ω–æ–≤–∏–π –¥—ñ–∞–ø–∞–∑–æ–Ω
        // –ê–ª–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏ —Ä–µ–Ω–¥–µ—Ä–∏–º–æ –∑–∞–Ω–æ–≤–æ, –ø—ñ–¥—Ç—è–≥—É—é—á–∏ state
        
        tbody.innerHTML = '';
        
        // –ó–º—ñ–Ω–Ω—ñ –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É "–Ω–∞ –ª—å–æ—Ç—É"
        let currentBody = startBody;
        let accumulatedInterest = 0;
        
        let totalInterestAccrued = 0;
        let totalCommission = 0;

        for (let d = 1; d <= days; d++) {
            // 1. –ù–∞—Ä–∞—Ö–æ–≤—É—î–º–æ –≤—ñ–¥—Å–æ—Ç–æ–∫ –∑–∞ —Ü–µ–π –¥–µ–Ω—å –Ω–∞ –ø–æ—Ç–æ—á–Ω–µ —Ç—ñ–ª–æ
            let dailyInt = currentBody * rate / 100;
            totalInterestAccrued += dailyInt;
            accumulatedInterest += dailyInt;

            // 2. –ß–∏ —î –ø–æ–≥–∞—à–µ–Ω–Ω—è –≤ —Ü–µ–π –¥–µ–Ω—å?
            let payInt = 0;
            let payBody = 0;
            let isCredit = false;

            if (kdzState[d]) {
                payInt = kdzState[d].int || 0;
                payBody = kdzState[d].body || 0;
                isCredit = kdzState[d].isCredit || false;
            }

            // –í–∞–ª—ñ–¥–∞—Ü—ñ—è: –Ω–µ –º–æ–∂–Ω–∞ –ø–æ–≥–∞—Å–∏—Ç–∏ –±—ñ–ª—å—à–µ –Ω—ñ–∂ —î
            // (–ê–ª–µ –¥–ª—è UX –¥–æ–∑–≤–æ–ª–∏–º–æ –≤–≤–æ–¥–∏—Ç–∏, –ø—Ä–æ—Å—Ç–æ –ø—ñ–¥—Å–≤—ñ—Ç–∏–º–æ, –∞–±–æ –æ–±—Ä—ñ–∂–µ–º–æ –≤ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∞—Ö)
            // –¢—É—Ç –ø—Ä–æ—Å—Ç–æ –≤—Ä–∞—Ö—É—î–º–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ
            
            let effectivePayInt = payInt;
            let effectivePayBody = payBody;
            
            // –Ø–∫—â–æ –ø–ª–∞—Ç–∏–º–æ –∫—Ä–µ–¥–∏—Ç–Ω–∏–º–∏ - –∫–æ–º—ñ—Å—ñ—è 4% –≤—ñ–¥ —Å—É–º–∏ –ø–æ–≥–∞—à–µ–Ω–Ω—è –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤
            if(isCredit) {
                totalCommission += (effectivePayInt * 0.04);
            }

            // 3. –í—ñ–¥–Ω—ñ–º–∞—î–º–æ –ø–æ–≥–∞—à–µ–Ω–Ω—è
            accumulatedInterest -= effectivePayInt;
            // –Ø–∫—â–æ –ø–æ–≥–∞—Å–∏–ª–∏ –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤ –±—ñ–ª—å—à–µ –Ω—ñ–∂ –±—É–ª–æ - (–≤ —Ä–µ–∞–ª—ñ —Ü–µ –π–¥–µ –≤ —Ç—ñ–ª–æ –∞–±–æ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞, —Ç—É—Ç —Å–ø—Ä–æ—Å—Ç–∏–º–æ: –º—ñ–Ω—É—Å –≤ % –º–æ–∂–ª–∏–≤–∏–π —è–∫ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞)
            if(accumulatedInterest < 0) accumulatedInterest = 0; 

            let bodyBefore = currentBody;
            currentBody -= effectivePayBody;
            if(currentBody < 0) currentBody = 0;

            // 4. –†–µ–Ω–¥–µ—Ä–∏–º–æ —Ä—è–¥–æ–∫
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td style="text-align:center;"><strong>${d}</strong></td>
                <td>${bodyBefore.toFixed(2)}</td>
                <td style="color:#666;">+${dailyInt.toFixed(2)}</td>
                
                <!-- –Ü–Ω–ø—É—Ç –ø–æ–≥–∞—à–µ–Ω–Ω—è –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤ -->
                <td style="background:#fffaf5;">
                    <input type="number" class="input-cell kdz-pay-int" 
                        data-day="${d}" value="${payInt > 0 ? payInt : ''}" placeholder="0">
                </td>
                
                <!-- –Ü–Ω–ø—É—Ç –ø–æ–≥–∞—à–µ–Ω–Ω—è —Ç—ñ–ª–∞ -->
                <td style="background:#f1f8ff;">
                    <input type="number" class="input-cell kdz-pay-body" 
                        data-day="${d}" value="${payBody > 0 ? payBody : ''}" placeholder="0">
                </td>

                <!-- –ß–µ–∫–±–æ–∫—Å –∫—Ä–µ–¥–∏—Ç–Ω–∏—Ö -->
                <td>
                    <label class="cb-wrapper" title="–û–ø–ª–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∏–º–∏ –∫–æ—à—Ç–∞–º–∏ (+4% –∫–æ–º—ñ—Å—ñ—ó)">
                        <input type="checkbox" class="kdz-is-credit" data-day="${d}" ${isCredit ? 'checked' : ''}>
                        –ö—Ä–µ–¥.
                    </label>
                </td>

                <td style="font-weight:600;">${currentBody.toFixed(2)}</td>
                <td style="color:${accumulatedInterest > 0.1 ? '#d32f2f' : 'green'}">${accumulatedInterest.toFixed(2)}</td>
            `;
            tbody.appendChild(tr);
        }

        // –û–Ω–æ–≤–ª—é—î–º–æ –≤–µ—Ä—Ö–Ω—ñ–π –±–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
        document.getElementById('liveBodyRemain').textContent = currentBody.toFixed(2) + ' –≥—Ä–Ω';
        document.getElementById('liveInterestTotal').textContent = totalInterestAccrued.toFixed(2) + ' –≥—Ä–Ω';
        document.getElementById('liveCommission').textContent = totalCommission.toFixed(2) + ' –≥—Ä–Ω';
        
        // –í—Å—å–æ–≥–æ –¥–æ –∑–∞–∫—Ä–∏—Ç—Ç—è = –ü–æ—Ç–æ—á–Ω–µ —Ç—ñ–ª–æ + –ù–∞–∫–æ–ø–∏—á–µ–Ω—ñ % + –ö–æ–º—ñ—Å—ñ—è (—è–∫–∞ –≤–∂–µ –Ω–∞—Ä–∞—Ö–æ–≤–∞–Ω–∞ –∑–∞ —Ñ–∞–∫—Ç –æ–ø–ª–∞—Ç)
        // –ê–ë–û: –°–∫—ñ–ª—å–∫–∏ –∫–ª—ñ—î–Ω—Ç –í–ñ–ï –≤–∏—Ç—Ä–∞—Ç–∏–≤ + —Å–∫—ñ–ª—å–∫–∏ —â–µ –≤–∏–Ω–µ–Ω.
        // –ó–∞–∑–≤–∏—á–∞–π —Ü—ñ–∫–∞–≤–∏—Ç—å: "–°–∫—ñ–ª—å–∫–∏ —â–µ —Ç—Ä–µ–±–∞ –∑–∞–∫–∏–Ω—É—Ç–∏ –∑–∞—Ä–∞–∑, —â–æ–± –∑–∞–∫—Ä–∏—Ç–∏ –≤—Å–µ?"
        // –¶–µ: –ó–∞–ª–∏—à–æ–∫ –¢—ñ–ª–∞ + –ë–æ—Ä–≥ –ø–æ % 
        let totalToCloseNow = currentBody + accumulatedInterest;
        document.getElementById('liveTotalToPay').textContent = totalToCloseNow.toFixed(2) + ' –≥—Ä–Ω';
    }

    // –°–ª—É—Ö–∞—î–º–æ –∑–º—ñ–Ω–∏ –≤ —Ç–∞–±–ª–∏—Ü—ñ (Event Delegation)
    document.querySelector('#kdzTable').addEventListener('input', (e) => {
        if (e.target.classList.contains('input-cell')) {
            const day = e.target.dataset.day;
            const val = parseFloat(e.target.value);
            const type = e.target.classList.contains('kdz-pay-int') ? 'int' : 'body';

            if (!kdzState[day]) kdzState[day] = {};
            kdzState[day][type] = isNaN(val) ? 0 : val;
            
            // –•–∏—Ç—Ä–∏–π —Ö—ñ–¥: –º–∏ –Ω–µ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–º–æ –≤—Å—é —Ç–∞–±–ª–∏—Ü—é (–±–æ –≤—Ç—Ä–∞—Ç–∏–º–æ —Ñ–æ–∫—É—Å), 
            // –∞ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏–º–æ –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –º–∞—Å–∏–≤—É —ñ –æ–Ω–æ–≤–∏–º–æ –¢–ï–ö–°–¢–û–í–Ü –∫–æ–º—ñ—Ä–∫–∏ –≤ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö —Ä—è–¥–∫–∞—Ö.
            // –ê–ª–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏ –∫–æ–¥—É —ñ –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ –≤ –ø–µ—Ä—à—ñ–π –≤–µ—Ä—Å—ñ—ó - –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–º–æ, –ê–õ–ï –∑–±–µ—Ä–µ–∂–µ–º–æ —Ñ–æ–∫—É—Å.
            
            saveFocusAndRender(e.target);
        }
    });

    document.querySelector('#kdzTable').addEventListener('change', (e) => {
        if (e.target.classList.contains('kdz-is-credit')) {
            const day = e.target.dataset.day;
            if (!kdzState[day]) kdzState[day] = {};
            kdzState[day].isCredit = e.target.checked;
            
            saveFocusAndRender(e.target);
        }
    });

    function saveFocusAndRender(targetElem) {
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –∫—É—Ä—Å–æ—Ä–∞ —ñ –µ–ª–µ–º–µ–Ω—Ç
        const day = targetElem.dataset.day;
        const isInt = targetElem.classList.contains('kdz-pay-int');
        const isBody = targetElem.classList.contains('kdz-pay-body');
        const isCheck = targetElem.classList.contains('kdz-is-credit');

        initKdzTable(); // –ü–µ—Ä–µ–º–∞–ª—å–æ–≤—É—î–º–æ –≤—Å–µ (–ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î–º–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫—É)

        // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ —Ñ–æ–∫—É—Å
        let newSelector = '';
        if (isInt) newSelector = `.kdz-pay-int[data-day="${day}"]`;
        if (isBody) newSelector = `.kdz-pay-body[data-day="${day}"]`;
        if (isCheck) newSelector = `.kdz-is-credit[data-day="${day}"]`;

        if (newSelector) {
            const el = document.querySelector(newSelector);
            if(el) {
                el.focus();
                // –î–ª—è —ñ–Ω–ø—É—Ç—ñ–≤ –∫—É—Ä—Å–æ—Ä –≤ –∫—ñ–Ω–µ—Ü—å (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
            }
        }
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    addPeriod31();
    addPeriod62();
    addPeriodOverdraft();
</script>
</body>
</html>
