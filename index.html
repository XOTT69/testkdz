<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä monobank</title>
    <style>
        :root {
            /* COLORS */
            --color-white: rgba(255, 255, 255, 1);
            --color-background: #fcfcf9;
            --color-surface: #fffffd;
            --color-text: #13343b;
            --color-text-secondary: #626c71;
            --color-primary: #21808d;
            --color-primary-hover: #1d7480;
            --color-border: rgba(94, 82, 64, 0.2);
            --color-card-border: rgba(94, 82, 64, 0.12);
            --color-error: #e54d4d;
            
            /* SLIDER COLORS */
            --color-slider-track: #e6e6e6;
            --color-slider-fill: #ea5b5b;
            --color-slider-thumb: #ffffff;
            
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 12px;
            --space-lg: 16px;
            --space-xl: 20px;
            
            --radius-base: 6px;
            --radius-lg: 8px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
            
            --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: #1f2121;
                --color-surface: #262828;
                --color-text: #f5f5f5;
                --color-text-secondary: #a7a9a9;
                --color-primary: #32b8c6;
                --color-primary-hover: #2da6b2;
                --color-border: rgba(119, 124, 124, 0.3);
                --color-card-border: rgba(119, 124, 124, 0.2);
            }
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        html { overflow-y: scroll; }

        body {
            font-family: var(--font-family-base);
            background-color: var(--color-background);
            color: var(--color-text);
            padding: var(--space-lg);
            line-height: 1.4;
            font-size: 14px;
        }
        
        .container { max-width: 960px; margin: 0 auto; }
        
        h1 { font-size: 22px; font-weight: 700; margin-bottom: 2px; color: var(--color-text); }
        .subtitle { color: var(--color-text-secondary); margin-bottom: var(--space-lg); font-size: 13px; }
        
        h2 { font-size: 18px; margin: 0; font-weight: 600; display: flex; align-items: center; } 
        h3 { font-size: 15px; margin: var(--space-md) 0 var(--space-sm) 0; font-weight: 600; }
        
        .tabs { display: flex; gap: var(--space-sm); margin-bottom: var(--space-lg); border-bottom: 1px solid var(--color-border); }
        .tab {
            padding: var(--space-sm) var(--space-lg);
            background: none; border: none;
            color: var(--color-text-secondary); cursor: pointer;
            font-size: 14px; font-weight: 500;
            border-bottom: 2px solid transparent; transition: all 0.2s;
        }
        .tab:hover { color: var(--color-text); }
        .tab.active { color: var(--color-primary); border-bottom-color: var(--color-primary); }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card {
            background-color: var(--color-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-card-border);
            padding: var(--space-lg);
            box-shadow: var(--shadow-sm);
            margin-bottom: var(--space-lg);
        }
        
        .card-header-row {
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: var(--space-lg); min-height: 32px;
        }

        .form-group { margin-bottom: var(--space-md); }
        label { display: block; margin-bottom: 4px; font-weight: 500; font-size: 13px; color: var(--color-text); }
        
        input[type="number"], input[type="date"], select {
            width: 100%; padding: 6px 10px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: 14px;
            background-color: var(--color-background);
            color: var(--color-text);
            transition: border-color 0.2s;
            height: 36px;
            font-family: inherit;
        }
        input[type="number"]:focus, input[type="date"]:focus, select:focus { outline: none; border-color: var(--color-primary); }
        
        /* SLIDER */
        .slider-container { width: 100%; padding: 10px 0; position: relative; }
        .slider-value-display { font-size: 24px; font-weight: 700; color: var(--color-text); margin-bottom: 8px; }
        .slider-labels { display: flex; justify-content: space-between; color: var(--color-text-secondary); font-size: 12px; margin-top: 4px; }
        input[type=range] {
            -webkit-appearance: none; width: 100%; height: 4px; background: var(--color-slider-track);
            border-radius: 2px; outline: none; padding: 0; margin: 0; cursor: pointer; border: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%;
            background: var(--color-white); border: 2px solid var(--color-slider-fill);
            cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.3); margin-top: -8px; position: relative; z-index: 2;
        }
        
        .btn {
            width: 100%; padding: 8px 16px; background-color: var(--color-primary); color: white; border: none; border-radius: var(--radius-base);
            font-size: 14px; font-weight: 600; cursor: pointer; transition: background-color 0.2s; height: 36px;
        }
        .btn:hover { background-color: var(--color-primary-hover); }
        
        .btn-ghost {
            background-color: rgba(33, 128, 141, 0.1); color: var(--color-primary); margin-bottom: var(--space-md);
            height: 32px; padding: 0 12px; font-size: 13px;
        }
        .btn-ghost:hover { background-color: rgba(33, 128, 141, 0.2); }
        .btn-outline { background-color: transparent; border: 1px solid var(--color-border); color: var(--color-text-secondary); font-weight: 500; }
        
        .result-section { margin-top: var(--space-lg); padding: var(--space-md); background-color: var(--color-background); border-radius: var(--radius-base); border: 1px solid var(--color-card-border); }
        .result-item { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--color-border); }
        .result-item:last-child { border-bottom: none; }
        .result-label { color: var(--color-text-secondary); font-size: 13px; }
        .result-value { font-weight: 600; font-size: 14px; color: var(--color-text); }
        .result-value.highlight { color: var(--color-primary); font-size: 16px; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-md); }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-sm); }
        @media (max-width: 640px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } }
        
        .rate-badge { display: inline-block; padding: 2px 8px; background-color: rgba(33, 128, 141, 0.15); color: var(--color-primary); border-radius: 4px; font-size: 12px; font-weight: 600; margin-left: var(--space-sm); }
        
        .period-card { background-color: var(--color-background); border: 1px solid var(--color-card-border); border-radius: var(--radius-base); padding: var(--space-md); margin-bottom: var(--space-md); }
        .period-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-sm); }
        .period-title { font-weight: 600; font-size: 13px; color: var(--color-text); }
        .remove-btn { background: none; border: none; color: var(--color-text-secondary); cursor: pointer; font-size: 18px; padding: 0; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; border-radius: 4px; }
        .remove-btn:hover { background-color: rgba(192, 21, 47, 0.1); color: rgba(192, 21, 47, 1); }

        .details-log-container { margin-top: var(--space-md); border-top: 1px solid var(--color-border); padding-top: var(--space-md); }
        .details-log { background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-base); padding: var(--space-md); font-family: monospace; font-size: 12px; color: var(--color-text-secondary); white-space: pre-wrap; max-height: 250px; overflow-y: auto; margin-top: var(--space-sm); }
        .copy-btn-container { display: flex; justify-content: flex-end; margin-top: 4px; }
        .text-link { color: var(--color-primary); cursor: pointer; font-size: 13px; border: none; background: none; padding: 0; text-decoration: underline; }

        .kdz-table-container { overflow-x: auto; border: 1px solid var(--color-border); border-radius: var(--radius-base); margin-top: var(--space-md); }
        .kdz-table { width: 100%; border-collapse: collapse; min-width: 500px; font-size: 13px; }
        .kdz-table th { background-color: rgba(33, 128, 141, 0.08); padding: 6px 8px; text-align: left; font-weight: 600; color: var(--color-text); border-bottom: 1px solid var(--color-border); }
        .kdz-table td { padding: 2px 8px; border-bottom: 1px solid var(--color-border); vertical-align: middle; color: var(--color-text); height: 32px; }
        .kdz-table tr:last-child td { border-bottom: none; }
        .kdz-input { width: 100%; padding: 2px 6px; font-size: 13px; text-align: right; border: 1px solid var(--color-border); border-radius: 4px; height: 26px; margin: 0; }
        .kdz-input:focus { border-color: var(--color-primary); outline: none; }
        .kdz-input.error { border-color: var(--color-error); background-color: rgba(229, 77, 77, 0.1); }

        .text-dim { color: var(--color-text-secondary); font-size: 12px; }
        .text-bold { font-weight: 600; }
        
        .payment-section { background-color: rgba(33, 128, 141, 0.04); border: 1px solid rgba(33, 128, 141, 0.2); border-radius: var(--radius-base); padding: var(--space-md); margin-top: var(--space-lg); }
        
        .error-message {
            color: var(--color-error); font-size: 12px; font-weight: 600; margin-top: 4px; display: none;
        }
        .error-message.visible { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¶ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä monobank</h1>
        <p class="subtitle" id="mainSubtitle">–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø—Ä–æ—Ü–µ–Ω—Ç—ñ–≤ –∑–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∏–º –ª—ñ–º—ñ—Ç–æ–º</p>
        
        <div class="tabs">
            <button class="tab active" data-tab="credit" data-sub="–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø—Ä–æ—Ü–µ–Ω—Ç—ñ–≤ –∑–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∏–º –ª—ñ–º—ñ—Ç–æ–º">–ö—Ä–µ–¥–∏—Ç–Ω–∏–π –ª—ñ–º—ñ—Ç</button>
            <button class="tab" data-tab="installment" data-sub="–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —â–æ–º—ñ—Å—è—á–Ω–∏—Ö –ø–ª–∞—Ç–µ–∂—ñ–≤ —Ç–∞ –∫–æ–º—ñ—Å—ñ—ó">–†–æ–∑—Å—Ç—Ä–æ—á–∫–∞</button>
            <button class="tab" data-tab="kdz" data-sub="–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ –∫—Ä–µ–¥–∏—Ç—É –¥–æ –∑–∞—Ä–ø–ª–∞—Ç–∏">–ö–î–ó (–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä)</button>
        </div>
        
        <!-- ... (Credit Limit and Installment sections remain unchanged) ... -->
        <!-- ======================= -->
        <!-- 1. –ö–†–ï–î–ò–¢–ù–ò–ô –õ–Ü–ú–Ü–¢      -->
        <!-- ======================= -->
        <div class="tab-content active" id="credit">
            <div class="card">
                <div class="card-header-row">
                    <h2>–ö—Ä–µ–¥–∏—Ç–Ω–∏–π –ª—ñ–º—ñ—Ç</h2>
                    <div style="display: flex; gap: var(--space-md); align-items: center;">
                        <label style="display: flex; align-items: center; gap: 6px; margin: 0; font-weight: normal; cursor: pointer;">
                            <input type="checkbox" id="leapYearCredit" style="width: auto;">
                            366 –¥–Ω—ñ–≤
                        </label>
                        <button class="btn btn-ghost" style="width: auto; margin: 0; padding: 0 8px; height: 28px; font-size: 12px;" onclick="resetCredit()">
                            üîÑ –û—á–∏—Å—Ç–∏—Ç–∏
                        </button>
                    </div>
                </div>
                
                <h3>–°—Ç–∞–≤–∫–∞ 3.1%</h3>
                <div id="periods31"></div>
                <button class="btn btn-ghost" onclick="addPeriod31()">+ –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥ 3.1%</button>
                
                <h3>–°—Ç–∞–≤–∫–∞ 6.2%</h3>
                <div id="periods62"></div>
                <button class="btn btn-ghost" onclick="addPeriod62()">+ –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥ 6.2%</button>
                
                <h3>–°—É–º–∞ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–æ–≥–æ –ª—ñ–º—ñ—Ç—É</h3>
                <div class="form-group">
                    <div style="display: flex; gap: var(--space-md);">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 6px 12px; border: 1px solid var(--color-border); border-radius: var(--radius-base); flex: 1; background-color: var(--color-background); height: 36px; margin: 0;">
                            <input type="radio" name="overdraftRange" value="less" checked style="width: auto;">
                            –ú–µ–Ω—à–µ 1000 –≥—Ä–Ω (3.1%)
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 6px 12px; border: 1px solid var(--color-border); border-radius: var(--radius-base); flex: 1; background-color: var(--color-background); height: 36px; margin: 0;">
                            <input type="radio" name="overdraftRange" value="more" style="width: auto;">
                            ‚â• 1000 –≥—Ä–Ω (6.2%)
                        </label>
                    </div>
                </div>
                <div id="periodsOverdraft"></div>
                <button class="btn btn-ghost" onclick="addPeriodOverdraft()">+ –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è</button>
                
                <button class="btn" onclick="calculateCredit()" style="margin-top: var(--space-sm);">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤—Å–µ —Ä–∞–∑–æ–º</button>
                
                <div class="result-section" id="resultCredit" style="display: none;">
                    <div class="result-item">
                        <span class="result-label">–í—ñ–¥—Å–æ—Ç–∫–∏ 3.1%</span>
                        <span class="result-value" id="interest31">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–í—ñ–¥—Å–æ—Ç–∫–∏ 6.2%</span>
                        <span class="result-value" id="interest62">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item" style="border-top: 2px solid var(--color-border); padding-top: var(--space-sm); margin-top: 4px;">
                        <span class="result-label" style="font-weight: 600;">–í—Å—å–æ–≥–æ –∑–∞ –∫—Ä–µ–¥–∏—Ç–Ω–∏–π –ª—ñ–º—ñ—Ç</span>
                        <span class="result-value highlight" id="totalInterest">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item" style="margin-top: var(--space-md); padding-top: var(--space-sm); border-top: 1px solid var(--color-border);">
                        <span class="result-label">–û–≤–µ—Ä–¥—Ä–∞—Ñ—Ç (<span id="appliedRate">0%</span>)</span>
                        <span class="result-value" id="interestOverdraft">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="details-log-container">
                        <button class="text-link" onclick="toggleDetails()">üìú –ü–æ–∫–∞–∑–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—É —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫—É</button>
                        <div id="detailsArea" style="display: none;">
                            <div class="details-log" id="detailsLogText"></div>
                            <div class="copy-btn-container">
                                <button class="btn btn-outline" style="width: auto; height: 28px; padding: 0 12px; font-size: 12px;" onclick="copyDetails()">–ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ======================= -->
        <!-- 2. –†–û–ó–°–¢–†–û–ß–ö–ê           -->
        <!-- ======================= -->
        <div class="tab-content" id="installment">
            <div class="card">
                <div class="card-header-row">
                    <h2>–†–æ–∑—Å—Ç—Ä–æ—á–∫–∞ <span class="rate-badge">1.9%/–º—ñ—Å</span></h2>
                    <button class="btn btn-ghost" style="width: auto; margin: 0; padding: 0 8px; height: 28px; font-size: 12px;" onclick="resetInst()">
                        üîÑ –û—á–∏—Å—Ç–∏—Ç–∏
                    </button>
                </div>
                
                <div class="form-group">
                    <label for="amountInst">–°—É–º–∞ (–º–∞–∫—Å 400 000 –≥—Ä–Ω)</label>
                    <input type="number" id="amountInst" value="30000" step="0.01" min="0" max="400000" oninput="liveUpdateInst()">
                    <div id="instError" class="error-message">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —Å—É–º–∞ —Ä–æ–∑—Å—Ç—Ä–æ—á–∫–∏ 400 000 –≥—Ä–Ω!</div>
                </div>

                <!-- Custom Slider -->
                <div class="form-group" style="margin-top: var(--space-xl);">
                    <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–ª–∞—Ç–µ–∂—ñ–≤</label>
                    <div class="slider-container">
                        <div class="slider-value-display" id="monthsDisplay">6</div>
                        <input type="range" id="monthsInst" min="3" max="24" value="6" oninput="updateSliderVisuals()">
                        <div class="slider-labels">
                            <span>3 –ø–ª–∞—Ç–µ–∂—ñ</span>
                            <span>24 –ø–ª–∞—Ç–µ–∂—ñ</span>
                        </div>
                    </div>
                </div>
                
                <button class="btn" onclick="calculateInstallment()" style="margin-top: var(--space-sm);">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
                
                <div class="result-section" id="resultInst" style="display: none;">
                    <div class="result-item">
                        <span class="result-label">–©–æ–º—ñ—Å—è—á–Ω–∏–π –ø–ª–∞—Ç—ñ–∂</span>
                        <span class="result-value highlight" id="monthlyPayment">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–ö–æ–º—ñ—Å—ñ—è –∑–∞ –º—ñ—Å—è—Ü—å</span>
                        <span class="result-value" id="monthlyFee">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–ó–∞–≥–∞–ª—å–Ω–∞ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞</span>
                        <span class="result-value" id="totalOverpayment">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–í—Å—å–æ–≥–æ –¥–æ —Å–ø–ª–∞—Ç–∏</span>
                        <span class="result-value" id="totalInstallment">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="details-log-container">
                        <button class="text-link" onclick="toggleDetailsInst()">üìú –ü–æ–∫–∞–∑–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –ø–ª–∞—Ç–µ–∂—ñ–≤</button>
                        <div id="detailsAreaInst" style="display: none;">
                            <div class="details-log" id="detailsLogInst"></div>
                            <div class="copy-btn-container">
                                <button class="btn btn-outline" style="width: auto; height: 28px; padding: 0 12px; font-size: 12px;" onclick="copyDetailsInst()">–ö–æ–ø—ñ—é–≤–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ======================= -->
        <!-- 3. –ö–î–ó (–Ü–ù–¢–ï–†–ê–ö–¢–ò–í)     -->
        <!-- ======================= -->
        <div class="tab-content" id="kdz">
            <div class="card">
                <div class="card-header-row">
                    <h2>–ö—Ä–µ–¥–∏—Ç ¬´–î–æ –∑–∞–≤—Ç—Ä–∞¬ª</h2>
                    <button class="btn btn-ghost" style="width: auto; margin: 0; padding: 0 8px; height: 28px; font-size: 12px;" onclick="resetKdz()">
                        üîÑ –û—á–∏—Å—Ç–∏—Ç–∏
                    </button>
                </div>

                <div class="grid-3" style="align-items: flex-end; margin-bottom: var(--space-lg);">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–¢—ñ–ª–æ (–≥—Ä–Ω)</label>
                        <input type="number" id="kdzBody" value="5000" oninput="rebuildKdzTable()">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–î–Ω—ñ–≤ (–º–∞–∫—Å 30)</label>
                        <input type="number" id="kdzDays" value="14" min="1" max="30" oninput="rebuildKdzTable()">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–°—Ç–∞–≤–∫–∞/–¥–µ–Ω—å</label>
                        <select id="kdzRate" onchange="recalculateKdz()">
                            <option value="0.3">0.3%</option>
                            <option value="0.5">0.5%</option>
                        </select>
                    </div>
                </div>

                <div class="kdz-table-container">
                    <table class="kdz-table" id="kdzTable">
                        <thead>
                            <tr>
                                <th style="text-align: center; width: 30px;">#</th>
                                <th>–¢—ñ–ª–æ (—Ä–∞–Ω–æ–∫)</th>
                                <th>–ù–∞—Ä–∞—Ö. %</th>
                                <th style="background-color: rgba(94, 82, 64, 0.04);">–ü–æ–≥–∞—à–µ–Ω–Ω—è —Ç—ñ–ª–∞</th>
                                <th>–¢—ñ–ª–æ (–≤–µ—á—ñ—Ä)</th>
                                <th>–ë–æ—Ä–≥ –ø–æ %</th>
                            </tr>
                        </thead>
                        <tbody id="kdzTbody"></tbody>
                    </table>
                </div>

                <!-- PAYMENT SECTION -->
                <div class="payment-section">
                    <h3 style="margin-top: 0; margin-bottom: var(--space-sm);">–ü–æ–≤–Ω–µ –ø–æ–≥–∞—à–µ–Ω–Ω—è</h3>
                    <div class="grid-2" style="align-items: flex-start;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–°—É–º–∞ –ø–æ–≥–∞—à–µ–Ω–Ω—è (–∑–∞–≥–∞–ª—å–Ω–∞)</label>
                            <input type="number" id="kdzTotalPayInput" placeholder="0" oninput="recalculateKdz()">
                            <div id="kdzError" class="error-message">–°—É–º–∞ –ø–µ—Ä–µ–≤–∏—â—É—î –±–æ—Ä–≥!</div>
                        </div>
                        <div class="form-group" style="margin-bottom: 0; height: 36px; display: flex; align-items: center;">
                            <label style="display: flex; align-items: center; cursor: pointer; margin: 0; font-weight: normal;">
                                <input type="checkbox" id="kdzIsCredit" style="width: auto; margin-right: 8px;" onchange="recalculateKdz()">
                                –ó –∫—Ä–µ–¥–∏—Ç–Ω–∏—Ö (+4%)
                            </label>
                        </div>
                    </div>
                </div>

                <div class="result-section">
                    <div class="result-item">
                        <span class="result-label">–ë–æ—Ä–≥ (–¢—ñ–ª–æ + % –¥–æ —Å–ø–∏—Å–∞–Ω–Ω—è)</span>
                        <span class="result-value highlight" id="liveTotalDebt">0.00 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–ü–æ–≥–∞—à–µ–Ω–æ –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤</span>
                        <span class="result-value" id="liveInterestPaid">0.00 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–ü–æ–≥–∞—à–µ–Ω–æ —Ç—ñ–ª–∞</span>
                        <span class="result-value" id="liveBodyPaid">0.00 –≥—Ä–Ω</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">–ó–∞–ª–∏—à–æ–∫ —Ç—ñ–ª–∞</span>
                        <span class="result-value" id="liveBodyRemain">0.00 –≥—Ä–Ω</span>
                    </div>
                     <div class="result-item">
                        <span class="result-label">–ö–æ–º—ñ—Å—ñ—è 4%</span>
                        <span class="result-value" id="liveCommission">0.00 –≥—Ä–Ω</span>
                    </div>
                </div>

            </div>
        </div>
    </div>
    
    <script>
        function getTodayString() { const d = new Date(); return d.toISOString().split('T')[0]; }
        function formatDateDDMM(date) { const day = String(date.getDate()).padStart(2, '0'); const month = String(date.getMonth() + 1).padStart(2, '0'); return `${day}.${month}`; }

        let periodCounter31 = 0; let periodCounter62 = 0; let periodCounterOverdraft = 0;
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
                document.getElementById('mainSubtitle').textContent = tab.getAttribute('data-sub');
                if(tabId === 'kdz' && document.getElementById('kdzTbody').children.length === 0) rebuildKdzTable();
            });
        });

        // CREDIT & INSTALLMENT JS (Hidden for brevity, same as before) ...
        function addPeriod31() { periodCounter31++; createPeriod('periods31', 'period31', periodCounter31, 25000); }
        function addPeriod62() { periodCounter62++; createPeriod('periods62', 'period62', periodCounter62, 25000); }
        function addPeriodOverdraft() { periodCounterOverdraft++; createPeriod('periodsOverdraft', 'periodOverdraft', periodCounterOverdraft, 2000); }
        function createPeriod(containerId, prefix, count, defaultAmt) { const today = getTodayString(); const div = document.createElement('div'); div.className = 'period-card'; div.id = prefix + '-' + count; div.innerHTML = `<div class="period-header"><span class="period-title">–ü–µ—Ä—ñ–æ–¥ ${count}</span><button class="remove-btn" onclick="document.getElementById('${prefix}-${count}').remove()">√ó</button></div><div class="grid-3"><div class="form-group" style="margin-bottom:0"><label>–î–∞—Ç–∞ –∑</label><input type="date" class="${prefix}-from" value="${today}"></div><div class="form-group" style="margin-bottom:0"><label>–ø–æ</label><input type="date" class="${prefix}-to" value="${today}"></div><div class="form-group" style="margin-bottom:0"><label>–°—É–º–∞</label><input type="number" class="${prefix}-amount" value="${defaultAmt}"></div></div>`; document.getElementById(containerId).appendChild(div); }
        function resetCredit() { document.getElementById('periods31').innerHTML = ''; document.getElementById('periods62').innerHTML = ''; document.getElementById('periodsOverdraft').innerHTML = ''; periodCounter31 = 0; periodCounter62 = 0; periodCounterOverdraft = 0; addPeriod31(); addPeriod62(); addPeriodOverdraft(); document.getElementById('leapYearCredit').checked = false; document.querySelector('input[name="overdraftRange"][value="less"]').checked = true; document.getElementById('resultCredit').style.display = 'none'; }
        function calculateCredit() { const daysInYear = document.getElementById('leapYearCredit').checked ? 366 : 365; let log31 = "", log62 = "", logOd = ""; const calcGroup = (selector, rate) => { let total = 0, logText = ""; document.querySelectorAll(selector).forEach(card => { const fromStr = card.querySelector('input[type="date"]:nth-of-type(1)').value; const toStr = card.querySelector('input[type="date"]:nth-of-type(2)').value; const amt = parseFloat(card.querySelector('input[type="number"]').value) || 0; if(fromStr && toStr) { const fromDate = new Date(fromStr); const toDate = new Date(toStr); let currentDate = new Date(fromDate); while (currentDate <= toDate) { const dailyInterest = (amt * 1 * rate * 12) / daysInYear / 100; logText += `${formatDateDDMM(currentDate)}: ${amt.toFixed(2)} √ó ${rate}% / ${daysInYear} = ${dailyInterest.toFixed(2)} –≥—Ä–Ω\n`; total += dailyInterest; currentDate.setDate(currentDate.getDate() + 1); } } }); return {total, logText}; }; const res31 = calcGroup('#periods31 .period-card', 3.1); const res62 = calcGroup('#periods62 .period-card', 6.2); const odRate = document.querySelector('input[name="overdraftRange"]:checked').value === 'more' ? 6.2 : 3.1; const resOd = calcGroup('#periodsOverdraft .period-card', odRate); document.getElementById('interest31').textContent = res31.total.toFixed(2) + ' –≥—Ä–Ω'; document.getElementById('interest62').textContent = res62.total.toFixed(2) + ' –≥—Ä–Ω'; document.getElementById('totalInterest').textContent = (res31.total + res62.total).toFixed(2) + ' –≥—Ä–Ω'; document.getElementById('appliedRate').textContent = odRate + '%'; document.getElementById('interestOverdraft').textContent = resOd.total.toFixed(2) + ' –≥—Ä–Ω'; document.getElementById('resultCredit').style.display = 'block'; let fullLog = ""; if(res31.logText) fullLog += "=== 3.1% ===\n" + res31.logText + "\n"; if(res62.logText) fullLog += "=== 6.2% ===\n" + res62.logText + "\n"; if(resOd.logText) fullLog += `=== –û–í–ï–†–î–†–ê–§–¢ ${odRate}% ===\n` + resOd.logText; document.getElementById('detailsLogText').textContent = fullLog; }
        function toggleDetails() { const el = document.getElementById('detailsArea'); el.style.display = el.style.display === 'none' ? 'block' : 'none'; }
        function copyDetails() { navigator.clipboard.writeText(document.getElementById('detailsLogText').textContent).then(() => alert('Copied!')); }
        function updateSliderVisuals() { const slider = document.getElementById('monthsInst'); document.getElementById('monthsDisplay').textContent = slider.value; const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100; slider.style.background = `linear-gradient(to right, #ea5b5b 0%, #ea5b5b ${percentage}%, #e6e6e6 ${percentage}%, #e6e6e6 100%)`; if(document.getElementById('resultInst').style.display === 'block') calculateInstallment(); }
        function liveUpdateInst() { const input = document.getElementById('amountInst'); const errorMsg = document.getElementById('instError'); if (parseFloat(input.value) > 400000) { input.value = 400000; errorMsg.classList.add('visible'); } else { errorMsg.classList.remove('visible'); } if(document.getElementById('resultInst').style.display === 'block') calculateInstallment(); }
        function calculateInstallment() { let amt = parseFloat(document.getElementById('amountInst').value) || 0; if (amt > 400000) amt = 400000; const mos = parseInt(document.getElementById('monthsInst').value) || 0; if (amt <= 0 || mos <= 0) return; const fee = amt * 0.019; const monthlyPrincipal = amt / mos; const monthlyTotal = monthlyPrincipal + fee; const over = fee * mos; document.getElementById('monthlyPayment').textContent = monthlyTotal.toFixed(2) + ' –≥—Ä–Ω'; document.getElementById('monthlyFee').textContent = fee.toFixed(2) + ' –≥—Ä–Ω'; document.getElementById('totalOverpayment').textContent = over.toFixed(2) + ' –≥—Ä–Ω'; document.getElementById('totalInstallment').textContent = (amt + over).toFixed(2) + ' –≥—Ä–Ω'; document.getElementById('resultInst').style.display = 'block'; let logText = `–°–£–ú–ê: ${amt.toFixed(2)} –≥—Ä–Ω | –¢–ï–†–ú–Ü–ù: ${mos} –º—ñ—Å\n`; for (let i = 1; i <= mos; i++) logText += `–ú—ñ—Å—è—Ü—å ${i}: ${monthlyTotal.toFixed(2)} –≥—Ä–Ω\n`; logText += `\n–ó–ê–ì–ê–õ–û–ú: ${(amt + over).toFixed(2)} –≥—Ä–Ω`; document.getElementById('detailsLogInst').textContent = logText; }
        function toggleDetailsInst() { const el = document.getElementById('detailsAreaInst'); el.style.display = el.style.display === 'none' ? 'block' : 'none'; }
        function copyDetailsInst() { navigator.clipboard.writeText(document.getElementById('detailsLogInst').textContent).then(() => alert('Copied!')); }
        function resetInst() { document.getElementById('amountInst').value = '30000'; document.getElementById('monthsInst').value = 6; updateSliderVisuals(); document.getElementById('resultInst').style.display = 'none'; document.getElementById('instError').classList.remove('visible'); }

        // === KDZ LOGIC (FIXED) ===
        function resetKdz() {
            document.querySelectorAll('#kdzTbody input').forEach(inp => inp.value = '');
            document.getElementById('kdzTotalPayInput').value = '';
            document.getElementById('kdzIsCredit').checked = false;
            recalculateKdz();
        }

        function rebuildKdzTable() {
            let days = parseInt(document.getElementById('kdzDays').value) || 14;
            if (days > 30) { days = 30; document.getElementById('kdzDays').value = 30; }
            const tbody = document.getElementById('kdzTbody');
            tbody.innerHTML = '';
            for (let d = 1; d <= days; d++) {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="text-align: center; color: var(--color-text-secondary);">${d}</td>
                    <td class="cell-body-start text-dim">0.00</td>
                    <td class="cell-int-daily text-dim">0.00</td>
                    <td style="background-color: rgba(94, 82, 64, 0.02);"><input type="number" class="kdz-input input-body" placeholder="0"></td>
                    <td class="cell-body-end text-bold">0.00</td>
                    <td class="cell-int-accum" style="font-weight: 500;">0.00</td>`;
                tbody.appendChild(tr);
            }
            recalculateKdz();
        }

        function recalculateKdz() {
            const startBody = parseFloat(document.getElementById('kdzBody').value) || 5000;
            const rate = parseFloat(document.getElementById('kdzRate').value) || 0.3;
            const rows = document.querySelectorAll('#kdzTbody tr');
            const totalRows = rows.length;
            
            let currentBody = startBody;
            let accumulatedInt = 0;
            
            // 1. Table Loop
            rows.forEach((row, index) => {
                const isLastDay = (index === totalRows - 1);
                let payInput = parseFloat(row.querySelector('.input-body').value) || 0;
                const inputElem = row.querySelector('.input-body');

                row.querySelector('.cell-body-start').textContent = currentBody.toFixed(2);
                
                // Interest accrual
                const dailyInt = currentBody * rate / 100;
                accumulatedInt += dailyInt;
                row.querySelector('.cell-int-daily').textContent = '+' + dailyInt.toFixed(2);
                
                // --- TABLE PAYMENT LOGIC ---
                // Intermediate: Pays Body Only. 
                // Last Day: Pays Body Only (User types in "Body Payment" column).
                // But we must validate sum <= Debt logic visually.
                
                // Apply payment to Body
                currentBody -= payInput;
                if(currentBody < 0) currentBody = 0;
                
                row.querySelector('.cell-body-end').textContent = currentBody.toFixed(2);
                row.querySelector('.cell-int-accum').textContent = accumulatedInt.toFixed(2);
            });

            // 2. Final Settlement / "Total Payment" Field Logic
            const totalDebt = currentBody + accumulatedInt;
            document.getElementById('liveTotalDebt').textContent = totalDebt.toFixed(2) + ' –≥—Ä–Ω';

            let totalPayment = parseFloat(document.getElementById('kdzTotalPayInput').value) || 0;
            const isCredit = document.getElementById('kdzIsCredit').checked;
            const errorMsg = document.getElementById('kdzError');

            // --- VALIDATION: Sum cannot exceed total debt ---
            if (totalPayment > totalDebt + 0.01) { 
                errorMsg.classList.add('visible');
            } else {
                errorMsg.classList.remove('visible');
            }

            // --- PAYMENT DISTRIBUTION ---
            let paymentForInterest = 0;
            let paymentForBody = 0;

            // Rule: "Interest is paid in 2 cases: Full Repayment OR Last Day"
            // The "Total Payment" field effectively acts as a settlement "Today" (at the end of the timeline).
            // Since the timeline ends on the Last Day, this payment follows Last Day logic: Interest First.
            
            // Wait, does "Last Day" mean row N? Yes. 
            // The bottom field is "Additional Payment" or "Total Settlement"? 
            // It's labeled "Full Repayment". 
            // If I pay PARTIAL here, does it pay interest?
            // "Case 2: Last Day". Yes, if we are at end of term, interest is due.
            // So logic: Priority to Interest.
            
            if (totalPayment >= accumulatedInt) {
                paymentForInterest = accumulatedInt;
                paymentForBody = totalPayment - accumulatedInt;
                if (paymentForBody > currentBody) paymentForBody = currentBody;
            } else {
                paymentForInterest = totalPayment;
                paymentForBody = 0;
            }

            const remainingBody = currentBody - paymentForBody;
            const commission = isCredit ? totalPayment * 0.04 : 0;

            document.getElementById('liveInterestPaid').textContent = paymentForInterest.toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('liveBodyPaid').textContent = paymentForBody.toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('liveBodyRemain').textContent = remainingBody.toFixed(2) + ' –≥—Ä–Ω';
            document.getElementById('liveCommission').textContent = commission.toFixed(2) + ' –≥—Ä–Ω';
        }

        document.getElementById('kdzTable').addEventListener('input', recalculateKdz);
        addPeriod31(); addPeriod62(); addPeriodOverdraft(); rebuildKdzTable(); updateSliderVisuals();
    </script>
</body>
</html>
